<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶©ë¶ í˜„ëŒ€ìë™ì°¨ ì¬ê³  ë¦¬ìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-tab { background-color: #002c5f !important; color: white !important; }
        th { background-color: #f3f4f6; position: sticky; top: 0; }
    </style>
</head>
<body class="bg-gray-100">
    <nav class="bg-[#002c5f] p-4 text-white text-center font-bold text-xl">
        ğŸš— ì¶©ë¶ í˜„ëŒ€ìë™ì°¨ ì¬ê³  í˜„í™© (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)
    </nav>

    <div class="max-w-7xl mx-auto p-4">
        <div id="tab-container" class="flex flex-wrap gap-2 mb-6 justify-center">
            </div>

        <div class="bg-white rounded-lg shadow overflow-x-auto max-h-[700px]">
            <table class="w-full text-sm text-left border-collapse">
                <thead>
                    <tr id="table-header">
                        </tr>
                </thead>
                <tbody id="table-body">
                    <tr>
                        <td colspan="10" class="p-10 text-center text-gray-500 text-lg">
                            ìƒë‹¨ ë©”ë‰´ì—ì„œ ì°¨ì¢…ì„ ì„ íƒí•˜ê±°ë‚˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allCarData = {};

        // 1. ì„œë²„(api/cars)ì—ì„œ ì—‘ì…€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function init() {
            try {
                const res = await fetch('/api/cars');
                allCarData = await res.json();
                
                const sheetNames = Object.keys(allCarData);
                if (sheetNames.length === 0) throw new Error("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");

                renderTabs(sheetNames);
                // ì²« ë²ˆì§¸ ì‹œíŠ¸ ë°ì´í„° ë°”ë¡œ ë³´ì—¬ì£¼ê¸°
                renderData(sheetNames[0]);
            } catch (err) {
                document.getElementById('table-body').innerHTML = `<tr><td colspan="10" class="p-10 text-center text-red-500">ì—ëŸ¬: ${err.message}<br>ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì—‘ì…€ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</td></tr>`;
            }
        }

        // 2. ì—‘ì…€ ì‹œíŠ¸ë³„ íƒ­(ë²„íŠ¼) ìƒì„±
        function renderTabs(names) {
            const container = document.getElementById('tab-container');
            container.innerHTML = names.map(name => 
                `<button onclick="renderData('${name}')" id="tab-${name}" class="px-4 py-2 bg-white border border-gray-300 rounded-full hover:bg-gray-100 transition shadow-sm">${name}</button>`
            ).join('');
        }

        // 3. ì„ íƒí•œ ì°¨ì¢…ì˜ ë°ì´í„°ë¥¼ í‘œë¡œ ê·¸ë¦¬ê¸°
        function renderData(sheetName) {
            const data = allCarData[sheetName];
            if (!data || data.length === 0) return;

            // íƒ­ í™œì„±í™” í‘œì‹œ
            document.querySelectorAll('#tab-container button').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById(`tab-${sheetName}`).classList.add('active-tab');

            // í—¤ë”(ì œëª©) ìƒì„±
            const headers = Object.keys(data[0]);
            document.getElementById('table-header').innerHTML = headers.map(h => `<th class="p-3 border-b">${h}</th>`).join('');

            // ë‚´ìš© ìƒì„±
            document.getElementById('table-body').innerHTML = data.map(row => `
                <tr class="hover:bg-gray-50 border-b">
                    ${headers.map(h => `<td class="p-3">${row[h] || '-'}</td>`).join('')}
                </tr>
            `).join('');
        }

        init();
    </script>
</body>
</html>
