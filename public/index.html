<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶©ë¶ í˜„ëŒ€ì°¨ ì¬ê³  ê²€ìƒ‰ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --hyundai-blue: #002c5f; }
        .bg-hyundai { background-color: var(--hyundai-blue); }
        .text-hyundai { color: var(--hyundai-blue); }
        .filter-select { @apply border rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <header class="bg-hyundai text-white p-5 shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">ğŸš— ì¶©ë¶ í˜„ëŒ€ì°¨ ì‹¤ì‹œê°„ ì¬ê³  í˜„í™©</h1>
            <span class="text-sm opacity-80">ì—‘ì…€ ì—…ë¡œë“œë¡œ ìë™ ì—…ë°ì´íŠ¸ë¨</span>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6">
        <div class="bg-white p-6 rounded-xl shadow-sm mb-8 grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">ì°¨ì¢… ì„ íƒ</label>
                <select id="select-model" class="w-full filter-select" onchange="updateSubFilters()">
                    <option value="">ì°¨ì¢…ì„ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">ì„¸ë¶€ íŠ¸ë¦¼</label>
                <select id="select-trim" class="w-full filter-select" onchange="applyFilters()">
                    <option value="">ì „ì²´</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">ì™¸ì¥ ì»¬ëŸ¬</label>
                <select id="select-color" class="w-full filter-select" onchange="applyFilters()">
                    <option value="">ì „ì²´</option>
                </select>
            </div>
            <div class="flex items-end">
                <button onclick="resetFilters()" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-2 rounded transition">
                    í•„í„° ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <div class="mb-4 text-sm text-gray-600">
            ì´ <span id="count-total" class="font-bold text-blue-600">0</span>ê°œì˜ ë§¤ë¬¼ì´ ê²€ìƒ‰ë˜ì—ˆìŠµë‹ˆë‹¤.
        </div>

        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 border-b">
                        <tr id="table-header">
                            </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        let rawData = {}; 
        let currentModelData = [];

        async function init() {
            try {
                const res = await fetch('/api/cars');
                rawData = await res.json();
                
                // ì°¨ì¢… ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì±„ìš°ê¸°
                const modelSelect = document.getElementById('select-model');
                Object.keys(rawData).forEach(model => {
                    const opt = document.createElement('option');
                    opt.value = model;
                    opt.textContent = model;
                    modelSelect.appendChild(opt);
                });
            } catch (e) { alert("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"); }
        }

        function updateSubFilters() {
            const model = document.getElementById('select-model').value;
            if(!model) return;
            
            currentModelData = rawData[model];
            
            // íŠ¸ë¦¼ í•„í„° ì—…ë°ì´íŠ¸
            const trims = [...new Set(currentModelData.map(item => item['íŠ¸ë¦¼']))];
            updateSelect('select-trim', trims);
            
            // ì»¬ëŸ¬ í•„í„° ì—…ë°ì´íŠ¸
            const colors = [...new Set(currentModelData.map(item => item['ì¹¼ë¼']))];
            updateSelect('select-color', colors);

            applyFilters();
        }

        function updateSelect(id, items) {
            const el = document.getElementById(id);
            el.innerHTML = '<option value="">ì „ì²´</option>';
            items.filter(Boolean).forEach(item => {
                const opt = document.createElement('option');
                opt.value = item;
                opt.textContent = item;
                el.appendChild(opt);
            });
        }

        function applyFilters() {
            const trimVal = document.getElementById('select-trim').value;
            const colorVal = document.getElementById('select-color').value;

            const filtered = currentModelData.filter(item => {
                return (!trim
